<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Messagerie InstantanÃ©e</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="/css/ui-components.css">
    <link rel="stylesheet" href="/css/messages.css">
    <link rel="stylesheet" href="/css/reactions.css">
    <link rel="stylesheet" href="/css/audio.css">
    <link rel="stylesheet" href="/css/forms.css">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <!-- Visualiseur d'image plein Ã©cran -->
    <div id="image-viewer">
        <button id="viewer-download" title="TÃ©lÃ©charger l'image"><i data-lucide="download"></i></button>
        <span id="viewer-close">&times;</span>
        <img id="viewer-content" src="" alt="Zoom">
    </div>

    <header>
        <button id="back-btn" class="header-icon-btn"><i data-lucide="chevron-left"></i></button>
        <div class="header-left" id="group-header-info" style="cursor: pointer;">
            <div class="header-group-avatar" id="header-group-avatar">ğŸ’¬</div>
            <span class="logo" id="header-group-name">GÃ©nÃ©ral</span>
        </div>
        <div class="header-buttons">
            <button id="visio-btn" title="Appel VidÃ©o"><i data-lucide="video"></i></button>
            <button id="profile-btn" title="Mon Profil"><div id="profile-avatar"></div></button>
        </div>
    </header>

    <ul id="messages"></ul>
    
    <div id="message-overlay" class="message-overlay" style="display: none;"></div>
    
    <div id="message-context-menu" class="context-menu" style="display: none;">
        <div class="reaction-bar">
            <span>ğŸ‘</span><span>â¤ï¸</span><span>ğŸ˜‚</span><span>ğŸ˜®</span><span>ğŸ˜¢</span><span>ğŸ™</span>
        </div>
        <ul class="context-menu-list">
            <li id="menu-reply"><span>RÃ©pondre</span><i data-lucide="reply"></i></li>
            <li id="menu-share"><span>Partager</span><i data-lucide="share-2"></i></li>
            <li id="menu-copy"><span>Copier</span><i data-lucide="copy"></i></li>
            <li id="menu-delete" class="danger"><span>Supprimer</span><i data-lucide="trash-2"></i></li>
        </ul>
    </div>

    <div id="reactions-detail-menu" class="context-menu" style="display: none;">
        <div class="reaction-bar">
            <span>ğŸ‘</span><span>â¤ï¸</span><span>ğŸ˜‚</span><span>ğŸ˜®</span><span>ğŸ˜¢</span><span>ğŸ™</span>
        </div>
        <div id="reactions-detail-list" class="reactions-detail-list">
            <!-- Liste des gens qui ont rÃ©agi -->
        </div>
    </div>

    <div id="share-menu" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-weight: normal;">Partager via</h3>
                <button id="close-share-btn" class="close-circle-btn"><i data-lucide="x"></i></button>
            </div>
            <ul class="context-menu-list" style="box-shadow: none; border: 1px solid #eee; animation: none;">
                <li id="share-sms"><span>Message (SMS)</span><i data-lucide="message-square"></i></li>
                <li id="share-mail"><span>E-mail</span><i data-lucide="mail"></i></li>
                <li id="share-copy-link"><span>Copier le lien</span><i data-lucide="link"></i></li>
            </ul>
        </div>
    </div>
    
    <div id="typing-indicator"></div>

    <div id="custom-toast" class="toast-notification" style="display: none;">
        <i data-lucide="check-circle"></i>
        <span>CopiÃ© dans le presse-papier</span>
    </div>

    <form id="form">
        <!-- AperÃ§u de l'image avant envoi -->
        <div id="image-preview-container">
            <img id="image-preview" src="" alt="Preview">
            <button id="remove-image-btn" type="button">&times;</button>
        </div>
        
        <div id="form-inner">
            <div id="input-wrapper" style="flex: 1; display: flex; flex-direction: column; min-width: 0;">
                <!-- AperÃ§u de la rÃ©ponse -->
                <div id="reply-preview-container" style="display: none;">
                    <div id="reply-preview-bar"></div>
                    <div id="reply-preview-content">
                        <span id="reply-preview-user"></span>
                        <span id="reply-preview-text"></span>
                    </div>
                    <button id="close-reply-btn" type="button"><i data-lucide="x"></i></button>
                </div>

                <div id="input-container">
                    <input id="input" autocomplete="off" placeholder="Ã‰crire un message..." />
                </div>
            </div>

            <button id="img-btn" type="button" class="action-circle-btn"><i data-lucide="camera"></i></button>
            <button id="mic-btn" type="button" class="action-circle-btn"><i data-lucide="mic"></i></button>

            <div id="recording-container" style="display: none;">
                <button id="delete-rec-btn" type="button" class="rec-action-btn"><i data-lucide="trash-2"></i></button>
                <div id="recording-info">
                    <span id="recording-timer">0:00</span>
                    <div id="waveform">
                        <!-- Les barres seront gÃ©nÃ©rÃ©es ici dynamiquement -->
                    </div>
                </div>
                <button id="stop-rec-btn" type="button" class="rec-action-btn pulse"><i data-lucide="pause"></i></button>
                <button id="send-rec-btn" type="button" class="rec-action-btn send-btn"><i data-lucide="send"></i></button>
            </div>
            
        </div>
    </form>

    <input type="file" id="message-image-input" accept="image/*" style="display: none;">

    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/common.js"></script>
    <script src="/js/media-optimizer.js"></script>
    <script src="/js/memory-manager.js"></script>
    <script src="/js/audio-recorder.js"></script>
    <script src="/js/context-menu.js"></script>
    <script src="/js/script.js"></script>
</body>
</html>
